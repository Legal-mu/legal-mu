generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(uuid())
  firstName     String         @map("first_name")
  lastName      String         @map("last_name")
  email         String         @unique
  password      String?
  dateOfBirth   DateTime?      @map("date_of_birth") @db.Date
  role          UserRole       @default(CLIENT)
  isActive      Boolean        @default(true) @map("is_active")
  resetToken    String?        @map("reset_token")
  resetTokenExp DateTime?      @map("reset_token_exp")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  avatar        String?
  googleId      String?        @unique @map("google_id")
  status        UserStatus     @default(APPROVED)
  lawyerProfile LawyerProfile?

  // Admin relations
  reviewedProfiles LawyerProfile[] @relation("AdminReviews")

  @@map("users")
}

model LawyerProfile {
  id                    String             @id @default(uuid())
  userId                String             @unique @map("user_id")
  fullLegalName         String?            @map("full_legal_name")
  title                 ProfessionalTitle?
  registrationNumber    String?            @map("registration_number")
  firmName              String?            @map("firm_name")
  address               String?
  city                  String?
  postal_code           String?
  country               String?
  phoneNumber           String?            @map("phone_number")
  
  practiceAreas         String[]           @map("practice_areas") // Array for Step 3, requirement says single select but schema says array. I'll stick to array but maybe treat as single in logic.
  admissionYear         Int?               @map("admission_year")
  experienceYears       Int?               @map("experience_years")
  languages             String[]
  
  biography             String?
  headshotUrl           String?            @map("headshot_url")
  
  websiteUrl            String?            @map("website_url")
  linkedinUrl           String?            @map("linkedin_url")
  twitterUrl            String?            @map("twitter_url")
  youtubeUrl            String?            @map("youtube_url")

  status                LawyerProfileStatus @default(INCOMPLETE)
  completionPercentage  Int                @default(0) @map("completion_percentage")
  completedSteps        Json?              @map("completed_steps") // Array of strings like ["step1", "step2"]
  
  submittedAt           DateTime?          @map("submitted_at")
  reviewedAt            DateTime?          @map("reviewed_at")
  reviewedById          String?            @map("reviewed_by_id")
  reviewedBy            User?              @relation("AdminReviews", fields: [reviewedById], references: [id])
  rejectionReason       String?            @map("rejection_reason")

  createdAt             DateTime           @default(now()) @map("created_at")
  updatedAt             DateTime           @updatedAt @map("updated_at")
  
  user                  User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("lawyer_profiles")
}

enum UserRole {
  ADMIN
  CLIENT
  LAWYER
}

enum UserStatus {
  PENDING
  APPROVED
  REJECTED
}

enum LawyerProfileStatus {
  INCOMPLETE
  PENDING_REVIEW
  APPROVED
  REJECTED
}

enum ProfessionalTitle {
  BARRISTER
  ATTORNEY
  NOTARY
}
